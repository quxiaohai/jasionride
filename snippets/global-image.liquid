{%- if desktop_size == blank -%}
    {%- assign desktop_size = '1920x' -%}
{%- endif -%}
{%- if mobile_size == blank -%}
    {%- assign mobile_size = '750x' -%}
{%- endif -%}
{%- if sizes_set == blank -%}
    {%- assign sizes_set = '100vw' -%}
{%- endif -%}
{%- if media_size != blank -%}
    {%- assign media_sizes = media_size | split: ' ' -%}
    {%- assign desktop_height = desktop_img.height
            | times: 100000
            | times: media_sizes[0]
            | divided_by: desktop_img.width
            | divided_by: 1000.0
    -%}
    {%- assign mobile_height = mobile_img.height
            | times: 100000
            | times: media_sizes[1]
            | divided_by: mobile_img.width
            | divided_by: 1000.0
    -%}
{%- endif -%}
{%- if mobile_img != blank -%}
    {%- assign mb_alt = mobile_img.alt | escape_once -%}
    {%- if mb_alt == blank -%}
        {%- assign mb_alt = mobile_img.src
                | replace: 'files/', ''
                | replace: '.jpg', ''
                | replace: '.png', ''
                | escape_once
        -%}
    {%- endif -%}
    {%- assign mobile_size = mobile_size | replace: 'x', '' | plus: 0 -%}
    {%- assign mobile_cls = 'mobile-done image ' | append: mobile_class -%}
{%- endif -%}
{%- if desktop_img != blank -%}
    {%- assign pc_alt = desktop_img.alt | escape_once -%}
    {%- if pc_alt == blank -%}
        {%- assign pc_alt = desktop_img.src
                | replace: 'files/', ''
                | replace: '.jpg', ''
                | replace: '.png', ''
                | escape_once
        -%}
    {%- endif -%}
    {%- assign desktop_size = desktop_size | replace: 'x', '' | plus: 0 -%}
    {%- if mobile_img != blank -%}
        {%- assign desktop_cls = 'desktop-done image ' | append: mobile_class -%}
    {%- else -%}
        {%- assign desktop_cls = 'image ' | append: mobile_class -%}
    {%- endif -%}
{%- endif -%}
{%- if media_type == 'icon' -%}
    {% if mobile_img != blank %}
        <img src="{{ mobile_img | image_url: width: mobile_size }}" loading="lazy" class="{{ mobile_cls }}"
             alt="{{ mb_alt }}"/>
    {% endif %}
    {%- if desktop_img != blank -%}
        <img src="{{ desktop_img | image_url: width: desktop_size }}" loading="lazy" class="{{ desktop_cls }}"
             alt="{{ pc_alt }}"/>
    {%- endif -%}
{%- elsif request.design_mode or preload -%}
    <picture class="media {{ desktop_class }} {{ mobile_class }} image tw-relative overflow-hidden">
        {%- if mobile_img != blank -%}
            <source
                    media="(max-width: 1023px)"
                    class="image {{ mobile_class }}"
                    srcset="{{ mobile_img | image_url: width: '400x' }} 400w, {{ mobile_img | image_url: width: '600x' }} 600w, {{ mobile_img | image_url: width: '800x' }} 800w, {{ mobile_img | image_url: width: '1000x' }} 1000w, {{ mobile_img | image_url: width: '1400w' }} 1400w, {{ mobile_img | image_url: width: '1800w' }} 1800w"
                    width="{{ mobile_img.width }}"
                    height="{{ mobile_img.height }}"
            >
        {%- endif -%}
        {%- assign desktop_cls = 'image ' | append: mobile_class -%}
        {%- if desktop_img != blank -%}
            {{- desktop_img | image_url: width: desktop_size | image_tag: alt: pc_alt, class: desktop_cls -}}
        {%- endif -%}
    </picture>
{%- else -%}
    <picture class="media {{ desktop_class }} {{ mobile_class }} image tw-relative overflow-hidden">
        {%- if mobile_img != blank -%}
            <source
                    media="(max-width: 1023px)"
                    class="image {{ mobile_class }}"
                    srcset="{{ mobile_img | image_url: width: '400x' }} 400w, {{ mobile_img | image_url: width: '600x' }} 600w, {{ mobile_img | image_url: width: '800x' }} 800w, {{ mobile_img | image_url: width: '1000x' }} 1000w, {{ mobile_img | image_url: width: '1400w' }} 1400w, {{ mobile_img | image_url: width: '1800w' }} 1800w"
                    width="{{ mobile_img.width }}"
                    height="{{ mobile_img.height }}"
            >
        {%- endif -%}
        {%- if desktop_img != blank -%}
            {%- assign desktop_cls = 'image ' | append: desktop_class -%}
            {{-
            desktop_img
            | image_url: width: desktop_size
            | image_tag:
            alt: pc_alt,
            class: desktop_cls,
            loading: 'lazy',
            widths: '180,360,540,720,900,1080,1400,1800',
            is: 'lazy-image'
            -}}
        {%- endif -%}
    </picture>
{%- endif -%}
